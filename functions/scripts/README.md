# Introduction
The scripts in this folder were created to delete old 'schouw' Features from the FTTX BOP Feature Layer.

## Identifying Features
To understand these scripts it's important to understand what Features are and how they are structured. 
A Feature is a data point on a Feature Layer, which is a layer of an ArcGIS map. 

In the case of FTTX a Feature is generated from an APPEEE form, which contains a location 
and (usually) image attachments. These Features are identified by both a key (often referred to as 'sleutel'), 
and an ID (often referred to as 'object ID' or 'Feature ID'). The key is composed of the address of 
the Feature (zip code + house number + optional house suffix), the ID is an auto-incremented integer ID 
which is managed by ArcGIS.

## Which Identifier To Use
We cannot always use both the key and the ID to get and manage Features. The key can always be found, however 
does not have to be unique, it is technically possible for different Features to have the same key. The ID is always 
unique, but can only be queried from ArcGIS. This means to get the ID we must present ArcGIS with the key, ArcGIS 
then returns a list of Features using that key.

NOTE: Currently when a form with the same key is uploaded the Feature will be updated instead of added.

# parse_gcloud_log.py
The 'parse_gcloud_log.py' is used to parse downloaded Google Cloud logs by finding specific debug messages. 
These messages are configured to contain a small portion of the APPEEE form, including the key, which can later be used 
to delete the Features from ArcGIS.

## Arguments
| Field      | Description                                               | Default | Required |
| :--------- | :-------------------------------------------------------- | :------ | :------: |
| (0) input  | The input log file. Can be a folder containing logs.      | None    | Yes      |
| (1) output | The output data file.                                     | None    | Yes      |

# find_arcgis_ids.py
The 'find_arcgis_ids.py' takes the file generated by 'parse_gcloud_log.py' and tried to find one ID for each key.
If an ID was found it will end up in the output file, which is identical to the input file with the addition of 
a "feature_id" field. If none or multiple IDs were found the proper information is logged, and the key skipped.

## Arguments
| Field               | Description                                             | Default | Required |
| :------------------ | :------------------------------------------------------ | :------ | :------: |
| (0) input           | The input log file.                                     | None    | Yes      |
| (1) output          | The output data file.                                   | None    | Yes      |
| --username          | ArcGIS username.                                        | None    | Yes      |
| --gcloud-project    | The Google Cloud project to get the ArcGIS secret from. | None    | Yes      |
| --gcloud-secret-key | The secret key used to get the ArcGIS secret.           | None    | Yes      |
| --service           | The Feature service URL.                                | None    | Yes      |

# delete_arcgis_features.py
'delete_arcgis_features.py' will take the file generated by 'find_arcgis_ids.py' and will delete 
all Features from ArcGIS found in that file. If 'find_arcgis_ids.py' was unable to find an ID for the key, 
this script will skip that Feature.

## Arguments
| Field               | Description                                             | Default | Required |
| :------------------ | :------------------------------------------------------ | :------ | :------: |
| (0) input           | The input log file.                                     | None    | Yes      |
| --username          | ArcGIS username.                                        | None    | Yes      |
| --gcloud-project    | The Google Cloud project to get the ArcGIS secret from. | None    | Yes      |
| --gcloud-secret-key | The secret key used to get the ArcGIS secret.           | None    | Yes      |
| --service           | The Feature service URL.                                | None    | Yes      |